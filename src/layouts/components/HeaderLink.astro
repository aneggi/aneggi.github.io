---
import type { HTMLAttributes } from 'astro/types';
import { SUPPORTED_LANGS, type Lang } from '@src/i18n/config';

type Props = HTMLAttributes<'a'>;

const { href = '', class: className, ...props } = Astro.props as Props;

const { pathname } = Astro.url;
const normalize = (value: string) => value.replace(/\/+$/, '') || '/';
const normalizedHref = normalize(href);
const normalizedPath = normalize(pathname);
const parts = normalizedPath.split('/').filter(Boolean);
const strippedLangPath = SUPPORTED_LANGS.includes(parts[0] as Lang) ? '/' + parts.slice(1).join('/') : normalizedPath;
const isActive = normalizedHref === normalizedPath || normalizedHref === strippedLangPath;
---

<a
	href={href}
	class:list={[className, { 'border-b border-zinc-500 dark:border-zinc-300': isActive }, { 'text-zinc-600 dark:text-zinc-200 hover:text-zinc-900 dark:hover:text-zinc-50': !isActive }, { 'text-zinc-950 dark:text-zinc-50': isActive }]}
	{...props}
>
	<slot />
</a>
