---
import type { CollectionEntry } from 'astro:content';
import FormattedDate from './FormattedDate.astro';
import { slugify, tagColorClass } from '@src/utils';
import { withLangPrefix, DEFAULT_LANG, type Lang } from '@src/i18n/config';

const { publication, lang = DEFAULT_LANG } = Astro.props as { publication: CollectionEntry<'publications'>; lang?: Lang };
const { title, description, pubDate, venue, link, tags } = publication.data;
---
<div class='flex flex-col gap-1 border-b py-2 mb-1 dark:border-b-zinc-700'>
  <div class='flex flex-wrap items-center gap-2 text-sm text-zinc-700 dark:text-zinc-300'>
    <FormattedDate date={pubDate} lang={lang} />
    {venue && <span class='text-zinc-500 dark:text-zinc-400'>Â· {venue}</span>}
  </div>
  <h3 class='font-semibold'>
    {link ? (
      <a class='underline' href={link} target='_blank' rel='noopener noreferrer'>
        {title}
      </a>
    ) : (
      title
    )}
  </h3>
  <p class='text-zinc-600 dark:text-zinc-300 text-sm leading-relaxed'>{description}</p>
  {tags?.length && (
    <div class='flex flex-wrap gap-2 mt-1'>
      {tags.map(tag => (
        <a
          class={`border rounded-2xl text-xs px-2 py-0.5 underline-offset-2 hover:underline transition ${tagColorClass(tag)}`}
          href={withLangPrefix(`/tags/${slugify(tag)}/`, lang)}
        >
          {tag}
        </a>
      ))}
    </div>
  )}
</div>
